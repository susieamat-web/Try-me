HTML
Copy code
<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Rabbit Worlds: Highscore Edition</title>
  <style>
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
    body {
      margin: 0;
      background: #111;
      font-family: sans-serif;
      color: white;
      overflow: hidden;
      touch-action: none;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    #game-container {
      flex-grow: 1;
      position: relative;
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    canvas {
      background: #87CEEB;
      width: 100%;
      max-width: 800px;
      display: block;
      border-bottom: 5px solid #2d5a27;
    }
    .ui {
      position: absolute;
      top: 10px;
      width: 100%;
      padding: 0 20px;
      display: flex;
      justify-content: space-between;
      pointer-events: none;
      z-index: 10;
      font-weight: bold;
      text-shadow: 2px 2px #000;
      font-size: 16px;
    }
    .controls {
      display: flex;
      width: 100%;
      height: 130px;
      background: #222;
      padding: 15px;
      gap: 15px;
    }
    .btn {
      flex: 1;
      font-size: 24px;
      cursor: pointer;
      border-radius: 15px;
      border: none;
      font-weight: bold;
      color: #333;
      background: #eee;
      box-shadow: 0 5px #000;
    }
    .btn:active { transform: translateY(3px); box-shadow: 0 2px #000; }
    #overlay {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.85);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 100;
      text-align: center;
    }
    .start-btn {
      padding: 20px 50px;
      background: orange;
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 26px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 4px #b37400;
    }
  </style>
</head>
<body>

<div id="game-container">
  <div class="ui">
    <div>Score: <span id="s">0</span> | ðŸ¥•: <span id="c">0</span></div>
    <div>Record: <span id="hs">0</span> | Lvl: <span id="l">1</span></div>
  </div>

  <div id="overlay">
    <h1 id="ot" style="color: orange; margin: 0; font-size: 45px;">RABBIT WORLDS</h1>
    <p id="os" style="margin-bottom: 20px;">Versla de kat en verzamel wortels!</p>
    <button class="start-btn" id="startBtn">START</button>
  </div>

  <canvas id="g" width="800" height="400"></canvas>
</div>

<div class="controls">
  <button id="jb" class="btn">SPRING</button>
  <button id="fb" class="btn" style="background: #ff4444; color: white;">VUUR ðŸ”¥</button>
</div>

<script>
  const canvas = document.getElementById("g");
  const ctx = canvas.getContext("2d");

  const elS = document.getElementById("s");
  const elC = document.getElementById("c");
  const elL = document.getElementById("l");
  const elHS = document.getElementById("hs");
  const overlay = document.getElementById("overlay");
  const overlayTitle = document.getElementById("ot");
  const overlaySub = document.getElementById("os");
  const startBtn = document.getElementById("startBtn");

  let running = false;
  let score, carrots, level, frame, p, stones, logs, items, cat;

  // FIX 1: highscore altijd als number
  let highscore = Number(localStorage.getItem("rabbit_highscore")) || 0;
  elHS.innerText = highscore;

  function setup() {
    score = 0;
    carrots = 0;
    level = 1;
    frame = 0;

    stones = [];
    logs = [];
    items = [];
    cat = null;

    p = { x: 60, y: 310, dy: 0, jumping: false };

    overlay.style.display = "none";
    overlayTitle.innerText = "RABBIT WORLDS";
    overlaySub.innerText = "Versla de kat en verzamel wortels!";

    if (!running) {
      running = true;
      loop();
    }
  }

  function gameOver() {
    running = false;
    if (score > highscore) {
      highscore = score;
      localStorage.setItem("rabbit_highscore", String(score));
    }
    elHS.innerText = highscore;
    overlay.style.display = "flex";
    overlayTitle.innerText = "GAME OVER";
  }

  const doJump = (e) => {
    e.preventDefault();
    if (!running) return;
    if (!p.jumping) {
      p.dy = -16;
      p.jumping = true;
    }
  };

  const doFire = (e) => {
    e.preventDefault();
    if (!running) return;
    stones.push({ x: p.x + 40, y: p.y + 20 });
  };

  // Buttons (mouse + touch)
  const jb = document.getElementById("jb");
  const fb = document.getElementById("fb");

  jb.addEventListener("mousedown", doJump);
  jb.addEventListener("touchstart", doJump, { passive: false });

  fb.addEventListener("mousedown", doFire);
  fb.addEventListener("touchstart", doFire, { passive: false });

  startBtn.addEventListener("click", setup);

  function drawRabbit(x, y) {
    ctx.fillStyle = "white";
    ctx.beginPath();
    ctx.ellipse(x + 20, y + 25, 18, 14, 0, 0, Math.PI * 2);
    ctx.fill();

    ctx.beginPath();
    ctx.arc(x + 30, y + 12, 10, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = "pink";
    ctx.fillRect(x + 26, y - 8, 4, 15);
    ctx.fillRect(x + 34, y - 8, 4, 15);
  }

  function drawCat(x, y) {
    ctx.fillStyle = "#333";
    ctx.beginPath();
    ctx.arc(x + 40, y + 40, 35, 0, Math.PI * 2);
    ctx.fill();

    ctx.beginPath();
    ctx.moveTo(x + 15, y + 15);
    ctx.lineTo(x + 30, y + 15);
    ctx.lineTo(x + 22, y + 35);
    ctx.fill();

    ctx.beginPath();
    ctx.moveTo(x + 50, y + 15);
    ctx.lineTo(x + 65, y + 15);
    ctx.lineTo(x + 57, y + 35);
    ctx.fill();

    ctx.fillStyle = "yellow";
    ctx.fillRect(x + 28, y + 35, 6, 6);
    ctx.fillRect(x + 46, y + 35, 6, 6);

    // HP-bar
    ctx.fillStyle = "red";
    ctx.fillRect(x, y - 15, (cat.hp / cat.max) * 80, 6);
  }

  function drawLog(x, y) {
    ctx.fillStyle = "#8B4513";
    ctx.fillRect(x, y, 60, 40);
    ctx.fillStyle = "#5D2E0A";
    ctx.fillRect(x, y + 15, 60, 4);
  }

  function loop() {
    if (!running) return;

    ctx.clearRect(0, 0, 800, 400);
    frame++;

    // physics
    p.dy += 0.8;
    p.y += p.dy;
    if (p.y > 310) {
      p.y = 310;
      p.dy = 0;
      p.jumping = false;
    }
    drawRabbit(p.x, p.y);

    // cat boss
    if (level >= 3 && !cat) cat = { x: 650, y: 100, hp: 12, max: 12, dir: 3 };
    if (cat) {
      cat.y += cat.dir;
      if (cat.y > 280 || cat.y < 20) cat.dir *= -1;
      drawCat(cat.x, cat.y);
    }

    // spawns
    if (frame % Math.max(30, 95 - level * 7) === 0 && !cat) logs.push({ x: 850, y: 335 });
    if (frame % 160 === 0) items.push({ x: 850, y: 160 + Math.random() * 80 });

    // FIX 2: splice veilig -> achterwaarts loopen
    for (let i = logs.length - 1; i >= 0; i--) {
      const l = logs[i];
      l.x -= (6 + level);
      drawLog(l.x, l.y);

      if (p.x < l.x + 50 && p.x + 35 > l.x && p.y < l.y + 35 && p.y + 35 > l.y) {
        gameOver();
        return;
      }
      if (l.x < -100) logs.splice(i, 1);
    }

    for (let i = items.length - 1; i >= 0; i--) {
      const it = items[i];
      it.x -= 5;

      ctx.fillStyle = "orange";
      ctx.beginPath();
      ctx.moveTo(it.x, it.y);
      ctx.lineTo(it.x + 20, it.y);
      ctx.lineTo(it.x + 10, it.y + 25);
      ctx.fill();

      if (p.x < it.x + 30 && p.x + 40 > it.x && p.y < it.y + 30 && p.y + 40 > it.y) {
        carrots++;
        score += 100;
        items.splice(i, 1);
      } else if (it.x < -50) {
        items.splice(i, 1);
      }
    }

    for (let i = stones.length - 1; i >= 0; i--) {
      const s = stones[i];
      s.x += 12;

      ctx.fillStyle = "#555";
      ctx.beginPath();
      ctx.arc(s.x, s.y, 10, 0, Math.PI * 2);
      ctx.fill();

      let hit = false;

      // hit logs
      for (let j = logs.length - 1; j >= 0; j--) {
        const l = logs[j];
        if (s.x > l.x - 10 && s.x < l.x + 70 && s.y > l.y - 10 && s.y < l.y + 50) {
          logs.splice(j, 1);
          hit = true;
          score += 50;
          break;
        }
      }

      // hit cat
      if (!hit && cat && s.x > cat.x && s.x < cat.x + 80 && s.y > cat.y && s.y < cat.y + 80) {
        cat.hp--;
        hit = true;
        if (cat.hp <= 0) {
          cat = null;
          score += 1000;
          level++;
        }
      }

      if (hit || s.x > 850) stones.splice(i, 1);
    }

    // level up
    if (score >= level * 1000 && !cat) level++;

    // ui
    elS.innerText = score;
    elC.innerText = carrots;
    elL.innerText = level;

    requestAnimationFrame(loop);
  }
</script>
</body>
</html>
