<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Rabbit Worlds</title>
  <style>
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
    body { margin: 0; background: #111; font-family: sans-serif; color: #fff; overflow: hidden; touch-action: none; height: 100vh; display: flex; flex-direction: column; }
    #game-container { flex-grow: 1; position: relative; width: 100%; display: flex; justify-content: center; align-items: center; }
    canvas { background: #87CEEB; width: 100%; max-width: 800px; display: block; border-bottom: 5px solid #2d5a27; }
    .ui { position: absolute; top: 10px; width: 100%; padding: 0 20px; display: flex; justify-content: space-between; pointer-events: none; z-index: 10; font-weight: bold; text-shadow: 2px 2px #000; font-size: 16px; }
    .controls { display: flex; width: 100%; height: 130px; background: #222; padding: 15px; gap: 15px; }
    .btn { flex: 1; font-size: 24px; cursor: pointer; border-radius: 15px; border: none; font-weight: bold; color: #333; background: #eee; box-shadow: 0 5px #000; }
    .btn:active { transform: translateY(3px); box-shadow: 0 2px #000; }
    #overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.85); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; text-align: center; padding: 20px; }
    .start-btn { padding: 18px 44px; background: orange; color: white; border: none; border-radius: 12px; font-size: 26px; font-weight: bold; cursor: pointer; box-shadow: 0 4px #b37400; }
    .sub { opacity: 0.9; max-width: 560px; }
  </style>
</head>
<body>

<div id="game-container">
  <div class="ui">
    <div>Score: <span id="s">0</span> | ðŸ¥•: <span id="c">0</span></div>
    <div>Highscore: <span id="hs">0</span> | Lvl: <span id="l">1</span></div>
  </div>

  <div id="overlay">
    <h1 id="ot" style="color: orange; margin: 0; font-size: 45px;">RABBIT WORLDS</h1>
    <p id="os" class="sub">Spring over boomstammen, verzamel wortels en versla de baas op level 2, 5, 7 en 10.</p>
    <p class="sub" style="margin-top:0;">Highscore: <span id="ohs">0</span></p>
    <button class="start-btn" id="startBtn">START</button>
  </div>

  <canvas id="g" width="800" height="400"></canvas>
</div>

<div class="controls">
  <button id="jb" class="btn">SPRING</button>
  <button id="fb" class="btn" style="background: #ff4444; color: white;">VUUR ðŸ”¥</button>
</div>

<script>
  // ====== Basis ======
  const canvas = document.getElementById("g");
  const ctx = canvas.getContext("2d");

  const elS = document.getElementById("s");
  const elC = document.getElementById("c");
  const elL = document.getElementById("l");
  const elHS = document.getElementById("hs");
  const elOHS = document.getElementById("ohs");

  const overlay = document.getElementById("overlay");
  const overlayTitle = document.getElementById("ot");
  const overlaySub = document.getElementById("os");
  const startBtn = document.getElementById("startBtn");

  const HIGHSCORE_KEY = "rabbit_highscore_v3";
  let highscore = Number(localStorage.getItem(HIGHSCORE_KEY)) || 0;
  elHS.textContent = highscore;
  elOHS.textContent = highscore;

  // Boss alleen op deze levels
  const baasLevels = new Set([2, 5, 7, 10]);
  const baasVerslagen = {}; // per level

  // Lanes om af te wisselen
  const boomstamLanesY = [335, 305];                 // wisselt tussen 2 hoogtes
  const wortelLanesY = [120, 170, 220, 270, 320];    // wisselt tussen meerdere hoogtes

  // ====== Game state ======
  let running = false;
  let lastT = 0;

  let score = 0;
  let wortels = 0;
  let level = 1;

  let konijn;
  let stenen = [];
  let boomstammen = [];
  let items = [];
  let baas = null;

  // Timers (delta-time)
  let tBoomstam = 0;
  let tWortel = 0;

  // toggles voor afwisseling
  let boomstamLaneIdx = 0;
  let wortelLaneIdx = 0;

  // ====== Helpers ======
  function rectHit(ax, ay, aw, ah, bx, by, bw, bh) {
    return ax < bx + bw && ax + aw > bx && ay < by + bh && ay + ah > by;
  }

  function resetSpel() {
    score = 0;
    wortels = 0;
    level = 1;

    stenen = [];
    boomstammen = [];
    items = [];
    baas = null;

    tBoomstam = 0;
    tWortel = 0;

    boomstamLaneIdx = 0;
    wortelLaneIdx = 0;

    for (const k in baasVerslagen) delete baasVerslagen[k];

    konijn = { x: 60, y: 310, dy: 0, jumping: false, w: 40, h: 40 };

    overlay.style.display = "none";
    overlayTitle.textContent = "RABBIT WORLDS";
    overlaySub.textContent = "Spring over boomstammen, verzamel wortels en versla de baas op level 2, 5, 7 en 10.";

    if (!running) {
      running = true;
      lastT = performance.now();
      requestAnimationFrame(loop);
    }
  }

  function gameOver() {
    running = false;

    if (score > highscore) {
      highscore = score;
      localStorage.setItem(HIGHSCORE_KEY, String(score));
    }

    elHS.textContent = highscore;
    elOHS.textContent = highscore;

    overlay.style.display = "flex";
    overlayTitle.textContent = "GAME OVER";
    overlaySub.textContent = "Druk op START om opnieuw te spelen.";
  }

  // ====== Controls ======
  function doJump(e) {
    e.preventDefault();
    if (!running) return;
    if (!konijn.jumping) {
      konijn.dy = -520; // pixels per seconde (delta-time)
      konijn.jumping = true;
    }
  }

  function doFire(e) {
    e.preventDefault();
    if (!running) return;
    stenen.push({ x: konijn.x + 40, y: konijn.y + 20, r: 10 });
  }

  document.getElementById("jb").addEventListener("mousedown", doJump);
  document.getElementById("jb").addEventListener("touchstart", doJump, { passive: false });

  document.getElementById("fb").addEventListener("mousedown", doFire);
  document.getElementById("fb").addEventListener("touchstart", doFire, { passive: false });

  startBtn.addEventListener("click", resetSpel);

  // ====== Draw ======
  function tekenKonijn(x, y) {
    ctx.fillStyle = "white";
    ctx.beginPath(); ctx.ellipse(x + 20, y + 25, 18, 14, 0, 0, Math.PI * 2); ctx.fill();
    ctx.beginPath(); ctx.arc(x + 30, y + 12, 10, 0, Math.PI * 2); ctx.fill();
    ctx.fillStyle = "pink";
    ctx.fillRect(x + 26, y - 8, 4, 15);
    ctx.fillRect(x + 34, y - 8, 4, 15);
  }

  function tekenBoomstam(x, y) {
    ctx.fillStyle = "#8B4513"; ctx.fillRect(x, y, 60, 40);
    ctx.fillStyle = "#5D2E0A"; ctx.fillRect(x, y + 15, 60, 4);
  }

  function tekenWortel(x, y) {
    ctx.fillStyle = "orange";
    ctx.beginPath();
    ctx.moveTo(x, y);
    ctx.lineTo(x + 20, y);
    ctx.lineTo(x + 10, y + 25);
    ctx.fill();
  }

  function spawnBaas(lvl) {
    const hp = 12 + Math.floor(lvl * 2);
    baas = { x: 640, y: 80, w: 80, h: 80, hp, max: hp, dir: 140 }; // dir = speed px/s
  }

  function tekenBaas(b) {
    ctx.fillStyle = "#333";
    ctx.beginPath(); ctx.arc(b.x + 40, b.y + 40, 35, 0, Math.PI * 2); ctx.fill();

    ctx.beginPath(); ctx.moveTo(b.x + 15, b.y + 15); ctx.lineTo(b.x + 30, b.y + 15); ctx.lineTo(b.x + 22, b.y + 35); ctx.fill();
    ctx.beginPath(); ctx.moveTo(b.x + 50, b.y + 15); ctx.lineTo(b.x + 65, b.y + 15); ctx.lineTo(b.x + 57, b.y + 35); ctx.fill();

    ctx.fillStyle = "yellow";
    ctx.fillRect(b.x + 28, b.y + 35, 6, 6);
    ctx.fillRect(b.x + 46, b.y + 35, 6, 6);

    ctx.fillStyle = "red";
    ctx.fillRect(b.x, b.y - 15, (b.hp / b.max) * 80, 6);
  }

  // ====== Loop met delta time ======
  function loop(now) {
    if (!running) return;

    // dt in seconden (max clamp tegen rare spikes)
    const dt = Math.min(0.033, (now - lastT) / 1000);
    lastT = now;

    // clear
    ctx.clearRect(0, 0, 800, 400);

    // gravity
    konijn.dy += 1400 * dt;
    konijn.y += konijn.dy * dt;

    if (konijn.y > 310) {
      konijn.y = 310;
      konijn.dy = 0;
      konijn.jumping = false;
    }

    // boss spawn alleen op level 2,5,7,10
    if (baasLevels.has(level) && !baasVerslagen[level] && !baas) {
      boomstammen.length = 0;
      items.length = 0;
      spawnBaas(level);
    }

    // Spawns alleen zonder baas
    if (!baas) {
      // snelheid/intervals (rustiger gemaakt)
      const boomstamInterval = Math.max(0.85, 1.25 - level * 0.05); // seconden
      const wortelInterval = 1.35; // seconden

      tBoomstam += dt;
      tWortel += dt;

      if (tBoomstam >= boomstamInterval) {
        tBoomstam = 0;

        const y = boomstamLanesY[boomstamLaneIdx % boomstamLanesY.length];
        boomstamLaneIdx++;
        boomstammen.push({ x: 850, y, w: 60, h: 40 });
      }

      if (tWortel >= wortelInterval) {
        tWortel = 0;

        const y = wortelLanesY[wortelLaneIdx % wortelLanesY.length];
        wortelLaneIdx++;
        items.push({ x: 850, y, w: 25, h: 30 });
      }
    }

    // teken speler
    tekenKonijn(konijn.x, konijn.y);

    // boomstammen bewegen
    const boomstamSpeed = 240 + level * 18; // px/s
    for (let i = boomstammen.length - 1; i >= 0; i--) {
      const b = boomstammen[i];
      b.x -= boomstamSpeed * dt;
      tekenBoomstam(b.x, b.y);

      if (rectHit(konijn.x, konijn.y, 35, 35, b.x, b.y, b.w, b.h)) {
        gameOver();
        return;
      }

      if (b.x < -120) boomstammen.splice(i, 1);
    }

    // wortels bewegen
    const wortelSpeed = 190; // px/s
    for (let i = items.length - 1; i >= 0; i--) {
      const it = items[i];
      it.x -= wortelSpeed * dt;
      tekenWortel(it.x, it.y);

      if (rectHit(konijn.x, konijn.y, 40, 40, it.x, it.y, it.w, it.h)) {
        wortels++;
        score += 100;
        items.splice(i, 1);
      } else if (it.x < -80) {
        items.splice(i, 1);
      }
    }

    // baas bewegen/tekenen
    if (baas) {
      baas.y += baas.dir * dt;
      if (baas.y > 280) { baas.y = 280; baas.dir *= -1; }
      if (baas.y < 20)  { baas.y = 20;  baas.dir *= -1; }
      tekenBaas(baas);
    }

    // stenen
    const steenSpeed = 520; // px/s
    for (let i = stenen.length - 1; i >= 0; i--) {
      const s = stenen[i];
      s.x += steenSpeed * dt;

      ctx.fillStyle = "#555";
      ctx.beginPath(); ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2); ctx.fill();

      let hit = false;

      // hit boomstam
      for (let j = boomstammen.length - 1; j >= 0; j--) {
        const b = boomstammen[j];
        if (rectHit(s.x - s.r, s.y - s.r, s.r * 2, s.r * 2, b.x, b.y, b.w, b.h)) {
          boomstammen.splice(j, 1);
          score += 50;
          hit = true;
          break;
        }
      }

      // hit baas
      if (!hit && baas) {
        if (rectHit(s.x - s.r, s.y - s.r, s.r * 2, s.r * 2, baas.x, baas.y, baas.w, baas.h)) {
          baas.hp--;
          score += 25;
          hit = true;

          if (baas.hp <= 0) {
            baasVerslagen[level] = true;
            baas = null;
            score += 1000;
            level++;
          }
        }
      }

      if (hit || s.x > 900) stenen.splice(i, 1);
    }

    // level-up (normale levels op score)
    if (!baasLevels.has(level)) {
      if (score >= level * 1000) level++;
    }

    // highscore live tonen (zonder te overschrijven in storage)
    elHS.textContent = highscore;
    elOHS.textContent = highscore;

    // UI
    elS.textContent = score;
    elC.textContent = wortels;
    elL.textContent = level;

    requestAnimationFrame(loop);
  }
</script>

</body>
</html>
