<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Rabbit Worlds</title>

<style>
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
body { margin: 0; background: #111; font-family: sans-serif; color: #fff; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
#game-container { flex-grow: 1; position: relative; display: flex; justify-content: center; align-items: center; }
canvas { background: #87CEEB; width: 100%; max-width: 800px; border-bottom: 5px solid #2d5a27; }
.ui { position: absolute; top: 10px; width: 100%; padding: 0 20px; display: flex; justify-content: space-between; font-weight: bold; text-shadow: 2px 2px #000; }
.controls { display: flex; width: 100%; height: 130px; background: #222; padding: 15px; gap: 15px; }
.btn { flex: 1; font-size: 24px; border-radius: 15px; border: none; font-weight: bold; background: #eee; box-shadow: 0 5px #000; }
.btn:active { transform: translateY(3px); box-shadow: 0 2px #000; }

#overlay {
  position: absolute; inset: 0;
  background: rgba(0,0,0,0.85);
  display: flex; flex-direction: column;
  justify-content: center; align-items: center;
  text-align: center;
}

.start-btn {
  padding: 18px 44px;
  background: orange;
  border: none;
  border-radius: 12px;
  font-size: 26px;
  font-weight: bold;
  cursor: pointer;
}

#bossBanner {
  position: absolute;
  top: 50px;
  left: 50%;
  transform: translateX(-50%);
  font-weight: 900;
  font-size: 30px;
  letter-spacing: 6px;
  color: #ff2e2e;
  text-shadow: 3px 3px #000;
  display: none;
}
</style>
</head>

<body>

<div id="game-container">
  <div class="ui">
    <div>Score: <span id="s">0</span> | ðŸ¥•: <span id="c">0</span></div>
    <div>Highscore: <span id="hs">0</span> | Lvl: <span id="l">1</span></div>
  </div>

  <div id="bossBanner">BOSS</div>

  <div id="overlay">
    <h1>RABBIT WORLDS</h1>
    <p>Jump over logs, collect carrots and defeat the boss every 5 levels.</p>
    <button class="start-btn" onclick="resetGame()">START</button>
  </div>

  <canvas id="g" width="800" height="400"></canvas>
</div>

<div class="controls">
  <button class="btn" onmousedown="jump()" ontouchstart="jump()">JUMP</button>
  <button class="btn" style="background:#ff4444;color:white;" onmousedown="fire()" ontouchstart="fire()">FIRE ðŸ”¥</button>
</div>

<script>
const canvas = document.getElementById("g");
const ctx = canvas.getContext("2d");

let running = false;
let lastTime = 0;

let score = 0;
let carrots = 0;
let level = 1;

let rabbit, logs, items, stones, boss;
let bossDefeated = {};
let highscore = Number(localStorage.getItem("rabbit_highscore")) || 0;

document.getElementById("hs").textContent = highscore;

function resetGame(){
  score = 0;
  carrots = 0;
  level = 1;
  logs = [];
  items = [];
  stones = [];
  boss = null;
  bossDefeated = {};
  rabbit = {x:60,y:310,dy:0,jumping:false};
  document.getElementById("overlay").style.display="none";
  running = true;
  lastTime = performance.now();
  requestAnimationFrame(loop);
}

function jump(){
  if(!running) return;
  if(!rabbit.jumping){
    rabbit.dy = -700; // higher jump
    rabbit.jumping = true;
  }
}

function fire(){
  if(!running) return;
  stones.push({x:rabbit.x+40,y:rabbit.y+20,r:10});
}

function rectHit(ax,ay,aw,ah,bx,by,bw,bh){
  return ax<bx+bw && ax+aw>bx && ay<by+bh && ay+ah>by;
}

function drawRabbit(x,y){
  ctx.fillStyle="white";
  ctx.beginPath();
  ctx.ellipse(x+20,y+25,18,14,0,0,Math.PI*2);
  ctx.fill();

  ctx.beginPath();
  ctx.arc(x+30,y+12,10,0,Math.PI*2);
  ctx.fill();

  ctx.fillRect(x+24,y-10,6,20);
  ctx.fillRect(x+34,y-10,6,20);

  ctx.fillStyle="pink";
  ctx.fillRect(x+26,y-8,2,16);
  ctx.fillRect(x+36,y-8,2,16);

  ctx.fillStyle="black";
  ctx.fillRect(x+32,y+10,2,2);
  ctx.fillRect(x+36,y+10,2,2);

  ctx.strokeStyle="black";
  ctx.beginPath();
  ctx.moveTo(x+40,y+14); ctx.lineTo(x+48,y+12);
  ctx.moveTo(x+40,y+14); ctx.lineTo(x+48,y+16);
  ctx.stroke();
}

function drawCarrot(x,y){
  // Leaves bigger
  ctx.fillStyle="#1e8f3e";
  ctx.beginPath();
  ctx.moveTo(x+10,y-18);
  ctx.lineTo(x-4,y+6);
  ctx.lineTo(x+10,y+2);
  ctx.fill();

  ctx.fillStyle="#2ecc71";
  ctx.beginPath();
  ctx.moveTo(x+10,y-18);
  ctx.lineTo(x+24,y+6);
  ctx.lineTo(x+10,y+2);
  ctx.fill();

  // Body
  ctx.fillStyle="#ff7f00";
  ctx.beginPath();
  ctx.moveTo(x,y);
  ctx.lineTo(x+22,y);
  ctx.lineTo(x+11,y+30);
  ctx.fill();

  // Texture lines
  ctx.strokeStyle="rgba(255,255,255,0.3)";
  ctx.beginPath();
  ctx.moveTo(x+6,y+8); ctx.lineTo(x+14,y+8);
  ctx.moveTo(x+7,y+16); ctx.lineTo(x+13,y+16);
  ctx.moveTo(x+8,y+24); ctx.lineTo(x+12,y+24);
  ctx.stroke();
}

function spawnBoss(){
  boss = {x:640,y:80,hp:20,max:20,dir:180};
  document.getElementById("bossBanner").style.display="block";
}

function drawBoss(b){
  ctx.fillStyle="#333";
  ctx.beginPath();
  ctx.arc(b.x+40,b.y+40,35,0,Math.PI*2);
  ctx.fill();

  ctx.beginPath();
  ctx.moveTo(b.x+20,b.y+25);
  ctx.lineTo(b.x+30,b.y+5);
  ctx.lineTo(b.x+40,b.y+25);
  ctx.fill();

  ctx.beginPath();
  ctx.moveTo(b.x+60,b.y+25);
  ctx.lineTo(b.x+50,b.y+5);
  ctx.lineTo(b.x+40,b.y+25);
  ctx.fill();

  ctx.fillStyle="yellow";
  ctx.fillRect(b.x+30,b.y+40,6,6);
  ctx.fillRect(b.x+46,b.y+40,6,6);

  ctx.strokeStyle="white";
  ctx.beginPath();
  ctx.moveTo(b.x+40,b.y+52); ctx.lineTo(b.x+20,b.y+48);
  ctx.moveTo(b.x+40,b.y+52); ctx.lineTo(b.x+60,b.y+48);
  ctx.stroke();

  ctx.fillStyle="red";
  ctx.fillRect(b.x,b.y-15,(b.hp/b.max)*80,6);
}

function loop(now){
  if(!running) return;
  const dt = (now-lastTime)/1000;
  lastTime=now;
  ctx.clearRect(0,0,800,400);

  rabbit.dy+=1400*dt;
  rabbit.y+=rabbit.dy*dt;
  if(rabbit.y>310){ rabbit.y=310; rabbit.dy=0; rabbit.jumping=false; }

  if(level%5===0 && !bossDefeated[level] && !boss){
    logs=[]; items=[];
    spawnBoss();
  }

  drawRabbit(rabbit.x,rabbit.y);

  requestAnimationFrame(loop);
}
</script>
</body>
</html>
