<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rabbit Adventure Pro</title>
    <style>
        body { margin: 0; text-align: center; background: #222; font-family: Arial, sans-serif; overflow: hidden; }
        canvas { background: #87CEEB; display: block; margin: 0 auto; border-bottom: 5px solid #2e7d32; }
        .ui-layer { color: white; position: absolute; top: 0; width: 100%; pointer-events: none; }
        .controls { position: absolute; bottom: 20px; width: 100%; display: flex; justify-content: center; gap: 20px; }
        button { 
            padding: 15px 25px; font-size: 18px; cursor: pointer; pointer-events: auto;
            border-radius: 10px; border: none; background: #eee; font-weight: bold;
        }
        #menu { position: absolute; inset: 0; background: rgba(0,0,0,0.8); display: flex; 
                flex-direction: column; align-items: center; justify-content: center; color: white; z-index: 10; }
    </style>
</head>
<body>

<div id="menu">
    <h1>RABBIT ADVENTURE</h1>
    <p id="highscore-display">Highscore: 0</p>
    <button onclick="startGame(1)">1 Speler</button><br>
    <button onclick="startGame(2)">2 Spelers (Om de beurt)</button>
</div>

<div class="ui-layer">
    <h2 id="stats">Level: 1 | Punten: 0</h2>
    <h3 id="player-turn"></h3>
</div>

<div class="controls">
    <button onmousedown="jump()" ontouchstart="jump()">SPRING (Spatie)</button>
    <button onmousedown="shoot()" ontouchstart="shoot()">SCHIET (F)</button>
    <button onclick="togglePause()">PAUZE (P)</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = 800;
canvas.height = 400;

// Game State
let gameActive = false;
let paused = false;
let score = 0;
let level = 1;
let highScore = localStorage.getItem("rabbitHighscore") || 0;
document.getElementById("highscore-display").innerText = "Highscore: " + highScore;

let players = 1;
let currentPlayer = 1;
let player1Score = 0;
let player2Score = 0;

// Entities
let rabbit = { x: 50, y: 300, w: 40, h: 40, dy: 0, jumping: false };
let obstacles = [];
let bullets = [];
let boss = null;
let frame = 0;

function startGame(numPlayers) {
    players = numPlayers;
    currentPlayer = 1;
    resetLevel(true);
    document.getElementById("menu").style.display = "none";
    gameActive = true;
    requestAnimationFrame(update);
}

function resetLevel(fullReset = false) {
    if(fullReset) { score = 0; level = 1; }
    rabbit.y = 300;
    obstacles = [];
    bullets = [];
    boss = null;
    frame = 0;
}

function drawRabbit() {
    ctx.fillStyle = "white";
    // Lichaam
    ctx.beginPath();
    ctx.ellipse(rabbit.x + 20, rabbit.y + 25, 20, 15, 0, 0, Math.PI * 2);
    ctx.fill();
    // Hoofd
    ctx.beginPath();
    ctx.arc(rabbit.x + 30, rabbit.y + 10, 12, 0, Math.PI * 2);
    ctx.fill();
    // Lange ronde oren
    ctx.beginPath();
    ctx.ellipse(rabbit.x + 25, rabbit.y - 5, 5, 12, 0.2, 0, Math.PI * 2);
    ctx.ellipse(rabbit.x + 35, rabbit.y - 5, 5, 12, -0.2, 0, Math.PI * 2);
    ctx.fill();
}

function spawnObstacle() {
    if (boss) return;
    let type = Math.random() > 0.5 ? 'ground' : 'air';
    obstacles.push({
        x: canvas.width,
        y: type === 'ground' ? 320 : 220,
        w: 30,
        h: 30,
        type: type,
        speed: 5 + level
    });
}

function spawnBoss(hp) {
    boss = { x: 600, y: 200, w: 80, h: 80, hp: hp, maxHp: hp, dir: 1 };
}

function update() {
    if (!gameActive || paused) return;

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    frame++;

    // Gravity
    rabbit.y += rabbit.dy;
    if (rabbit.y < 300) {
        rabbit.dy += 0.8;
    } else {
        rabbit.y = 300;
        rabbit.jumping = false;
    }

    drawRabbit();

    // Boss Logic
    if (level === 10 && !boss) spawnBoss(5);
    if (level === 20 && !boss) spawnBoss(10);

    if (boss) {
        ctx.fillStyle = "purple";
        boss.y += boss.dir * 2;
        if (boss.y > 280 || boss.y < 50) boss.dir *= -1;
        ctx.fillRect(boss.x, boss.y, boss.w, boss.h);
        // Boss HP bar
        ctx.fillStyle = "red";
        ctx.fillRect(boss.x, boss.y - 20, (boss.hp / boss.maxHp) * 80, 10);
    }

    // Obstacles
    if (frame % Math.max(20, 100 - (level * 3)) === 0) spawnObstacle();
    
    obstacles.forEach((obs, index) => {
        obs.x -= obs.speed;
        ctx.fillStyle = obs.type === 'ground' ? "#6d4c41" : "#f44336";
        ctx.fillRect(obs.x, obs.y, obs.w, obs.h);

        // Collision Rabbit
        if (rabbit.x < obs.x + obs.w && rabbit.x + rabbit.w > obs.x &&
            rabbit.y < obs.y + obs.h && rabbit.y + rabbit.h > obs.y) {
            gameOver();
        }
        if (obs.x < -50) {
            obstacles.splice(index, 1);
            score += 10;
        }
    });

    // Bullets
    bullets.forEach((b, bi) => {
        b.x += 10;
        ctx.fillStyle = "yellow";
        ctx.fillRect(b.x, b.y, 10, 5);

        if (boss && b.x < boss.x + boss.w && b.x + 10 > boss.x && b.y < boss.y + boss.h && b.y + 5 > boss.y) {
            bullets.splice(bi, 1);
            boss.hp--;
            if (boss.hp <= 0) {
                score += 1000;
                boss = null;
                level++;
                if(level > 20) winGame();
            }
        }

        obstacles.forEach((obs, oi) => {
            if (obs.type === 'air' && b.x < obs.x + obs.w && b.x + 10 > obs.x && b.y < obs.y + obs.h && b.y + 5 > obs.y) {
                obstacles.splice(oi, 1);
                bullets.splice(bi, 1);
                score += 50;
            }
        });
    });

    // Level up check
    if (score > level * 500 && !boss && level < 21) {
        level++;
    }

    document.getElementById("stats").innerText = `Level: ${level} | Punten: ${score}`;
    requestAnimationFrame(update);
}

function jump() {
    if (!rabbit.jumping) {
        rabbit.dy = -15;
        rabbit.jumping = true;
    }
}

function shoot() {
    bullets.push({ x: rabbit.x + 40, y: rabbit.y + 20 });
}

function togglePause() {
    paused = !paused;
    if (!paused) requestAnimationFrame(update);
}

function gameOver() {
    gameActive = false;
    if (players === 2 && currentPlayer === 1) {
        player1Score = score;
        currentPlayer = 2;
        alert("Speler 1 af! Nu Speler 2.");
        resetLevel();
        gameActive = true;
        requestAnimationFrame(update);
    } else {
        if (players === 2) player2Score = score;
        checkHighscore();
    }
}

function winGame() {
    gameActive = false;
    alert("GEWONNEN! Je hebt de laatste baas verslagen!");
    checkHighscore();
}

function checkHighscore() {
    let finalScore = players === 2 ? Math.max(player1Score, player2Score) : score;
    if (finalScore > highScore) {
        let name = prompt("Nieuwe Highscore! Voer je naam in:");
        localStorage.setItem("rabbitHighscore", finalScore + " (" + name + ")");
    }
    location.reload();
}

// Controls
window.addEventListener("keydown", (e) => {
    if (e.code === "Space") jump();
    if (e.code === "KeyF") shoot();
    if (e.code === "KeyP") togglePause();
});
</script>
</body>
</html>
