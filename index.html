<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rabbit Adventure: Carrot Catch</title>
    <style>
        body { margin: 0; text-align: center; background: #1a1a1a; font-family: sans-serif; overflow: hidden; }
        canvas { display: block; margin: 0 auto; background: #87CEEB; border-bottom: 10px solid #388e3c; }
        .ui { color: white; position: absolute; top: 10px; width: 100%; pointer-events: none; }
        .controls { position: absolute; bottom: 20px; width: 100%; display: flex; justify-content: center; gap: 15px; }
        button { 
            padding: 15px 30px; font-size: 18px; cursor: pointer; pointer-events: auto;
            border-radius: 15px; border: 2px solid white; background: rgba(0,0,0,0.5); color: white;
        }
        #menu { position: absolute; inset: 0; background: rgba(0,0,0,0.9); display: flex; 
                flex-direction: column; align-items: center; justify-content: center; color: white; z-index: 10; }
    </style>
</head>
<body>

<div id="menu">
    <h1>ðŸ¥• RABBIT ADVENTURE</h1>
    <p id="hs">Highscore: 0</p>
    <button onclick="startGame(1)">1 Speler</button>
    <button onclick="startGame(2)" style="margin-top:10px;">2 Spelers (Om de beurt)</button>
</div>

<div class="ui">
    <h2 id="stats">Level: 1 | Punten: 0</h2>
    <h3 id="turn"></h3>
</div>

<div class="controls">
    <button onclick="jump()">SPRING</button>
    <button onclick="shoot()">SCHIET</button>
    <button onclick="togglePause()">PAUZE</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = 800;
canvas.height = 400;

const GROUND_Y = 310; // De vaste lijn waar alles op staat
let gameActive = false, paused = false, score = 0, level = 1, frame = 0;
let players = 1, currentPlayer = 1, p1Score = 0;
let highScore = localStorage.getItem("rabbitHS") || 0;
document.getElementById("hs").innerText = "Highscore: " + highScore;

let rabbit = { x: 50, y: GROUND_Y, w: 40, h: 40, dy: 0, jumping: false };
let obstacles = [], bullets = [], boss = null;

function startGame(n) {
    players = n; currentPlayer = 1; score = 0; level = 1;
    resetGame();
    document.getElementById("menu").style.display = "none";
    gameActive = true;
    update();
}

function resetGame() {
    rabbit.y = GROUND_Y;
    obstacles = []; bullets = []; boss = null; frame = 0;
    document.getElementById("turn").innerText = players === 2 ? "Speler " + currentPlayer : "";
}

function drawRabbit() {
    ctx.fillStyle = "white";
    // Lichaam
    ctx.beginPath(); ctx.ellipse(rabbit.x + 20, rabbit.y + 25, 20, 15, 0, 0, Math.PI * 2); ctx.fill();
    // Hoofd
    ctx.beginPath(); ctx.arc(rabbit.x + 30, rabbit.y + 10, 12, 0, Math.PI * 2); ctx.fill();
    // Ronde oren
    ctx.beginPath(); ctx.ellipse(rabbit.x + 25, rabbit.y - 5, 5, 12, 0.2, 0, Math.PI * 2); ctx.fill();
    ctx.beginPath(); ctx.ellipse(rabbit.x + 35, rabbit.y - 5, 5, 12, -0.2, 0, Math.PI * 2); ctx.fill();
}

function drawCarrot(x, y) {
    ctx.fillStyle = "#FF9800"; // Oranje
    ctx.beginPath();
    ctx.moveTo(x, y);
    ctx.lineTo(x + 25, y);
    ctx.lineTo(x + 12, y + 35);
    ctx.closePath(); ctx.fill();
    ctx.fillStyle = "#4CAF50"; // Groen
    ctx.fillRect(x + 8, y - 8, 10, 8);
}

function drawBush(x, y) {
    ctx.fillStyle = "#2E7D32"; // Donkergroen
    ctx.beginPath(); ctx.arc(x+10, y+20, 15, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(x+25, y+15, 18, 0, Math.PI*2); ctx.fill();
}

function update() {
    if (!gameActive || paused) return;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    frame++;

    // Springen en Zwaartekracht
    if (rabbit.y < GROUND_Y) { rabbit.dy += 0.8; } 
    else { rabbit.y = GROUND_Y; rabbit.dy = 0; rabbit.jumping = false; }
    rabbit.y += rabbit.dy;
    drawRabbit();

    // Eindbaas Logica
    if ((level === 10 || level === 20) && !boss) {
        boss = { x: 600, y: 150, w: 80, h: 80, hp: level === 10 ? 5 : 10, max: level === 10 ? 5 : 10, dir: 2 };
    }

    if (boss) {
        boss.y += boss.dir;
        if (boss.y > 250 || boss.y < 50) boss.dir *= -1;
        ctx.fillStyle = "purple";
        ctx.fillRect(boss.x, boss.y, boss.w, boss.h);
        ctx.fillStyle = "red";
        ctx.fillRect(boss.x, boss.y - 15, (boss.hp/boss.max) * 80, 10);
    }

    // Obstakels Spawnen
    if (frame % Math.max(30, 100 - (level * 3)) === 0 && !boss) {
        let isAir = Math.random() > 0.5;
        obstacles.push({ x: 850, y: isAir ? 200 : GROUND_Y, w: 30, h: 30, type: isAir ? 'air' : 'ground' });
    }

    // Beweeg Obstakels
    obstacles.forEach((obs, i) => {
        obs.x -= (5 + level);
        if (obs.type === 'air') drawCarrot(obs.x, obs.y); else drawBush(obs.x, obs.y);

        // Botsing met Konijn
        if (rabbit.x < obs.x + obs.w && rabbit.x + 35 > obs.x && rabbit.y < obs.y + obs.h && rabbit.y + 35 > obs.y) {
            gameOver();
        }
        if (obs.x < -50) obstacles.splice(i, 1);
    });
