<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rabbit Worlds Mobile</title>
    <style>
        body { margin: 0; overflow: hidden; background: #5cc6ff; font-family: sans-serif; touch-action: none; }
        canvas { display: block; width: 100vw; height: 100vh; image-rendering: pixelated; }
        #ui { 
            position: fixed; top: 10px; left: 10px; color: white; background: rgba(0,0,0,0.5); 
            padding: 10px; border-radius: 10px; pointer-events: none; font-weight: bold; font-size: 14px;
        }
        /* Mobiele Besturing Visueel */
        .controls {
            position: fixed; bottom: 20px; left: 20px; right: 20px;
            display: flex; justify-content: space-between; align-items: flex-end;
            z-index: 100; pointer-events: none;
        }
        .btn {
            width: 70px; height: 70px; background: rgba(255,255,255,0.3);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            color: white; font-size: 30px; border: 2px solid white; pointer-events: auto;
        }
        .jump-btn { width: 90px; height: 90px; background: rgba(0,255,136,0.4); }
    </style>
</head>
<body>

<div id="ui">
    WORLD: <span id="w">1</span> | SCORE: <span id="s">0</span> | ❤️: <span id="l">3</span>
</div>

<div class="controls">
    <div style="display:flex; gap:15px;">
        <div class="btn" id="leftBtn">←</div>
        <div class="btn" id="rightBtn">→</div>
    </div>
    <div class="btn jump-btn" id="jumpBtn">↑</div>
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game"), ctx = canvas.getContext("2d");
const W = 960, H = 540;
let world = 1, score = 0, lives = 3, camX = 0, active = true;

// Player & Game State
const player = { x: 100, y: 300, w: 40, h: 40, vx: 0, vy: 0, onG: false, dir: 1 };
const enemies = [];
const TILE = 40;

// Input State
let moveLeft = false, moveRight = false;

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.onresize = resize; resize();

// Touch Controls
const setupBtn = (id, start, end) => {
    const el = document.getElementById(id);
    el.addEventListener('touchstart', (e) => { e.preventDefault(); start(); });
    el.addEventListener('touchend', (e) => { e.preventDefault(); end(); });
};

setupBtn('leftBtn', () => moveLeft = true, () => moveLeft = false);
setupBtn('rightBtn', () => moveRight = true, () => moveRight = false);
setupBtn('jumpBtn', () => { if(player.onG) player.vy = -15; }, () => {});

// Simple Game Loop
function update() {
    if(!active) return;

    // Movement
    if (moveLeft) player.vx = -5;
    else if (moveRight) player.vx = 5;
    else player.vx = 0;

    player.x += player.vx;
    player.vy += 0.8; // Gravity
    player.y += player.vy;

    // Basic Ground Collision (Simplified for demo)
    if (player.y > H - 80) {
        player.y = H - 80;
        player.vy = 0;
        player.onG = true;
    } else {
        player.onG = false;
    }

    // Camera follow
    camX = player.x - canvas.width / 4;

    // Enemy Spawn
    if (Math.random() < 0.01) enemies.push({x: player.x + 800, y: H-80, w: 30});

    enemies.forEach((en, i) => {
        en.x -= 3;
        // Collision
        if (Math.abs(player.x - en.x) < 30 && Math.abs(player.y - en.y) < 30) {
            if (player.vy > 0) { enemies.splice(i, 1); score += 50; }
            else { lives--; player.x -= 100; }
        }
    });

    document.getElementById('s').innerText = score;
    document.getElementById('l').innerText = lives;
    if(lives <= 0) location.reload();
}

function draw() {
    ctx.clearRect(0,0,canvas.width, canvas.height);
    ctx.save();
    ctx.translate(-camX, 0);

    // Draw Ground
    ctx.fillStyle = "#3aa655";
    ctx.fillRect(camX, H-40, canvas.width, 40);

    // Draw Player (Rabbit placeholder)
    ctx.fillStyle = "white";
    ctx.beginPath();
    ctx.arc(player.x, player.y, 20, 0, Math.PI*2);
    ctx.fill();
    // Ears
    ctx.fillRect(player.x-15, player.y-35, 10, 20);
    ctx.fillRect(player.x+5, player.y-35, 10, 20);

    // Draw Enemies
    ctx.fillStyle = "red";
    enemies.forEach(en => {
        ctx.beginPath();
        ctx.arc(en.x, en.y, 15, 0, Math.PI*2);
        ctx.fill();
    });

    ctx.restore();
}

function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
