<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rabbit Worlds: Final Edition</title>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: #1a1a1a; font-family: sans-serif; color: white; overflow: hidden; touch-action: none; display: flex; flex-direction: column; height: 100vh; }
        #game-container { flex-grow: 1; position: relative; width: 100%; display: flex; align-items: center; justify-content: center; }
        canvas { display: block; width: 100%; max-width: 800px; background: #87CEEB; border-bottom: 4px solid #4da33a; }
        .ui { position: absolute; top: 10px; width: 100%; padding: 0 20px; display: flex; justify-content: space-between; pointer-events: none; z-index: 10; font-weight: bold; text-shadow: 2px 2px #000; }
        .controls { display: flex; width: 100%; height: 130px; background: #222; padding: 15px; gap: 15px; }
        .btn { flex: 1; font-size: 24px; cursor: pointer; border-radius: 15px; border: none; font-weight: bold; box-shadow: 0 4px #000; }
        #overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.85); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; text-align: center; }
        .start-btn { width: 200px; height: 65px; background: #ff4444; color: white; border: none; border-radius: 12px; font-size: 24px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div id="game-container">
    <div class="ui">
        <div>Score: <span id="s">0</span> | Wortels: <span id="c">0</span></div>
        <div id="l">Level: 1</div>
    </div>
    <div id="overlay">
        <h1 id="m" style="color: orange; font-size: 40px; margin: 0;">RABBIT WORLDS</h1>
        <p id="t">Versla de Kat en verzamel wortels!</p>
        <button class="start-btn" onclick="init()">START</button>
    </div>
    <canvas id="cvs" width="800" height="400"></canvas>
</div>

<div class="controls">
    <button id="jb" class="btn" style="background: #fff;">SPRONG</button>
    <button id="fb" class="btn" style="background: #ff4444; color: white;">VUUR ðŸ”¥</button>
</div>

<script>
    const cvs = document.getElementById("cvs"), ctx = cvs.getContext("2d");
    let score, carrots, level, frame, running = false, paused = false;
    let p, stones, logs, items, cat;

    function init() {
        score = 0; carrots = 0; level = 1; frame = 0;
        stones = []; logs = []; items = []; cat = null;
        p = { x: 50, y: 310, dy: 0, j: false };
        document.getElementById("overlay").style.display = "none";
        if (!running) { running = true; loop(); }
        paused = false;
    }

    const jump = (e) => { e.preventDefault(); if(!p.j && running) { p.dy = -16; p.j = true; } };
    const fire = (e) => { e.preventDefault(); if(running) stones.push({ x: p.x + 45, y: p.y + 20 }); };
    document.getElementById("jb").onmousedown = document.getElementById("jb").ontouchstart = jump;
    document.getElementById("fb").onmousedown = document.getElementById("fb").ontouchstart = fire;

    function drawR(x, y) {
        ctx.fillStyle = "white"; ctx.beginPath(); ctx.ellipse(x + 20, y + 25, 18, 14, 0, 0, 7); ctx.fill();
        ctx.beginPath(); ctx.arc(x + 30, y + 12, 10, 0, 7); ctx.fill();
        ctx.fillStyle = "pink"; ctx.fillRect(x + 26, y - 8, 4, 15); ctx.fillRect(x + 34, y - 8, 4, 15);
    }

    function drawC(x, y) {
        ctx.fillStyle = "#555"; ctx.beginPath(); ctx.arc(x+40, y+40, 35, 0, 7); ctx.fill();
        ctx.fillStyle = "yellow"; ctx.fillRect(x+25, y+30, 8, 8); ctx.fillRect(x+47, y+30, 8, 8);
        ctx.strokeStyle = "white"; ctx.beginPath(); ctx.moveTo(x+10, y+45); ctx.lineTo(x-10, y+40); ctx.stroke();
    }

    function loop() {
        if (!running) return;
        ctx.clearRect(0, 0, 800, 400);
        frame++;

        // Player
        p.dy += 0.8; p.y += p.dy;
        if (p.y > 310) { p.y = 310; p.dy = 0; p.j = false; }
        drawR(p.x, p.y);

        // Cat Boss logic
        if (score >= 1500 && !cat) cat = { x: 650, y: 100, hp: 12, max: 12, d: 3 };
        if (cat) {
            cat.y += cat.d;
            if (cat.y > 280 || cat.y < 20) cat.d *= -1;
            drawC(cat.x, cat.y);
            ctx.fillStyle = "red"; ctx.fillRect(cat.x, cat.y - 15, (cat.hp/cat.max)*80, 8);
        }

        // Spawning
        if (frame % Math.max(30, 90 - level * 5) === 0 && !cat) logs.push({ x: 850, y: 335 });
        if (frame % 150 === 0) items.push({ x: 850, y: 220 });

        // Logs
        logs.forEach((l, i) => {
            l.x -= (6 + level);
            ctx.fillStyle = "#8B4513"; ctx.fillRect(l.x, l.y, 60, 40);
            if (p.x < l.x + 55 && p.x + 35 > l.x && p.y < l.y + 35 && p.y + 35 > l.y) {
                running = false; document.getElementById("overlay").style.display = "flex";
                document.getElementById("m").innerText = "GAME OVER";
            }
            if (l.x < -100) logs.splice(i, 1);
        });

        // Wortels
        items.forEach((it, i) => {
            it.x -= 5;
            ctx.fillStyle = "orange"; ctx.beginPath(); ctx.moveTo(it.x, it.y); ctx.lineTo(it.x+20, it.y); ctx.lineTo(it.x+10, it.y+25); ctx.fill();
            if (p.x < it.x + 25 && p.x + 40 > it.x && p.y < it.y + 25 && p.y + 40 > it.y) {
                carrots++; score += 100; items.splice(i, 1);
            }
        });

        // Stones & Combat
        stones.forEach((s, si) => {
            s.x += 12;
            ctx.fillStyle = "#444"; ctx.beginPath(); ctx.arc(s.x, s.y, 10, 0, 7); ctx.fill();
            
            logs.forEach((l, li) => {
                if (s.x > l.x - 10 && s.x < l.x + 70 && s.y > l.y - 10 && s.y < l.y + 50) {
                    logs.splice(li, 1); stones.splice(si, 1); score += 50;
                }
            });

            if (cat && s.x > cat.x && s.x < cat.x + 80 && s.y > cat.y && s.y < cat.y + 80) {
                cat.hp--; stones.splice(si, 1);
                if (cat.hp <= 0) { cat = null; score += 1000; level++; }
            }
            if (s.x > 850) stones.splice(si, 1);
        });

        document.getElementById("s").innerText = score;
        document.getElementById("c").innerText = carrots;
        document.getElementById("l").innerText = "Level: " + level;
        requestAnimationFrame(loop);
    }
</script>
</body>
</html>
