<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rabbit Worlds: Cat Edition</title>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            margin: 0; background: #1a1a1a; font-family: sans-serif; 
            color: white; overflow: hidden; touch-action: none; display: flex; flex-direction: column; height: 100vh; 
        }
        #game-container { flex-grow: 1; position: relative; width: 100%; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        canvas { display: block; width: 100%; max-width: 800px; background: #87CEEB; }
        
        .ui-top { 
            position: absolute; top: 10px; width: 100%; padding: 0 20px;
            display: flex; justify-content: space-between; align-items: flex-start;
            pointer-events: none; z-index: 10; font-weight: bold; text-shadow: 2px 2px #000;
        }
        
        .pause-btn {
            pointer-events: auto; width: 45px; height: 45px; background: #eee; color: #333;
            border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer;
        }

        .controls { display: flex; width: 100%; height: 130px; background: #222; padding: 15px; gap: 15px; }
        .ctrl-btn { flex: 1; font-size: 24px; cursor: pointer; border-radius: 15px; border: none; font-weight: bold; }
        #jumpBtn { background: #fff; color: #333; }
        #fireBtn { background: #ff4444; color: #fff; }

        #overlay { 
            position: absolute; inset: 0; background: rgba(0,0,0,0.9); 
            display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; 
        }
        .menu-card { background: #333; padding: 30px; border-radius: 20px; border: 4px solid #ff4444; text-align: center; }
    </style>
</head>
<body>

<div id="game-container">
    <div class="ui-top">
        <div id="stats">
            <div id="scoreDisplay">Score: 0</div>
            <div id="carrotDisplay" style="color: orange;">Wortels: 0 ðŸ¥•</div>
        </div>
        <button class="pause-btn" onclick="togglePause()">||</button>
    </div>

    <div id="overlay">
        <div class="menu-card">
            <h1 id="menuTitle" style="color: #ff4444; margin: 0;">RABBIT WORLDS</h1>
            <p id="menuText">Sla de boomstammen kapot!</p>
            <button id="startBtn" onclick="startGame()" style="width: 180px; height: 60px; background: #ff4444; color: white; border: none; border-radius: 10px; font-size: 22px; font-weight: bold; cursor: pointer;">START SPEL</button>
        </div>
    </div>

    <canvas id="gameCanvas" width="800" height="400"></canvas>
</div>

<div class="controls">
    <button id="jumpBtn" class="ctrl-btn">SPRING</button>
    <button id="fireBtn" class="ctrl-btn">VUUR ðŸ”¥</button>
</div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    
    let score = 0, carrots = 0, level = 1, frame = 0;
    let running = false, paused = false, gameTimer = null;

    let p = { x: 50, y: 310, dy: 0, jumping: false };
    let logs = [], stones = [], powerups = [], cat = null;

    function startGame() {
        if (paused) { togglePause(); return; }
        
        // Reset speldata
        score = 0; carrots = 0; level = 1; frame = 0;
        logs = []; stones = []; powerups = []; cat = null;
        p.y = 310; p.dy = 0;
        
        document.getElementById("overlay").style.display = "none";
        running = true;
        paused = false;

        // Start de motor opnieuw om zeker te weten dat hij draait
        if (gameTimer) clearInterval(gameTimer);
        gameTimer = setInterval(update, 1000 / 60);
    }

    function togglePause() {
        if (!running) return;
        paused = !paused;
        document.getElementById("overlay").style.display = paused ? "flex" : "none";
        document.getElementById("menuTitle").innerText = "PAUZE";
        document.getElementById("startBtn").innerText = "VERDER";
    }

    function gameOver() {
        running = false;
        clearInterval(gameTimer);
        document.getElementById("overlay").style.display = "flex";
        document.getElementById("menuTitle").innerText = "GAME OVER";
        document.getElementById("menuText").innerText = "Eindscore: " + score;
        document.getElementById("startBtn").innerText = "OPNIEUW";
    }

    // Input handlers
    const jumpAction = (e) => { e.preventDefault(); if (!p.jumping && running && !paused) { p.dy = -16; p.jumping = true; } };
    const fireAction = (e) => { e.preventDefault(); if (running && !paused) stones.push({ x: p.x + 45, y: p.y + 20 }); };

    document.getElementById("jumpBtn").onmousedown = document.getElementById("jumpBtn").ontouchstart = jumpAction;
    document.getElementById("fireBtn").onmousedown = document.getElementById("fireBtn").ontouchstart = fireAction;

    function drawRabbit(x, y) {
        ctx.fillStyle = "white";
        ctx.beginPath(); ctx.ellipse(x + 25, y + 30, 20, 15, 0, 0, Math.PI * 2); ctx.fill();
        ctx.beginPath(); ctx.arc(x + 35, y + 15, 12, 0, Math.PI * 2); ctx.fill();
        ctx.fillStyle = "pink"; ctx.fillRect(x + 30, y - 10, 6, 20); ctx.fillRect(x + 40, y - 10, 6, 20);
    }

    function drawCat(x, y) {
        ctx.fillStyle = "#555"; 
        ctx.beginPath(); ctx.arc(x + 50, y + 50, 40, 0, Math.PI * 2); ctx.fill(); // Lijf
        ctx.beginPath(); ctx.moveTo(x+20, y+20); ctx.lineTo(x+40, y+20); ctx.lineTo(x+30, y+50); ctx.fill(); // Oor L
        ctx.beginPath(); ctx.moveTo(x+60, y+20); ctx.lineTo(x+80, y+20); ctx.lineTo(x+70, y+50); ctx.fill(); // Oor R
        ctx.fillStyle = "yellow"; ctx.beginPath(); ctx.arc(x+40, y+45, 5, 0, Math.PI*2); ctx.fill(); // Oog
        ctx.beginPath(); ctx.arc(x+60, y+45, 5, 0, Math.PI*2); ctx.fill(); // Oog
    }

    function update() {
        if (!running || paused) return;

        ctx.clearRect(0, 0, 800, 400);
        frame++;

        // Konijn zwaartekracht
        p.dy += 0.8; p.y += p.dy;
        if (p.y > 310) { p.y = 310; p.dy = 0; p.jumping = false; }
        drawRabbit(p.x, p.y);

        // Kat-baas verschijnt bij level 3
        if (level >= 3 && !cat) cat = { x: 650, y: 100, hp: 10, max: 10, dir: 3 };
        if (cat) {
            cat.y += cat.dir;
            if (cat.y > 280 || cat.y < 20) cat.dir *= -1;
            drawCat(cat.x, cat.y);
            ctx.fillStyle = "red"; ctx.fillRect(cat.x, cat.y - 15, (cat.hp/cat.max) * 100, 8);
        }

        // Spawn obstakels
        if (frame % Math.max(30, 80 - level * 5) === 0 && !cat) {
            logs.push({ x: 850, y: 335, w: 60, h: 40 });
        }
        if (frame % 150 === 0) {
            powerups.push({ x: 850, y: 200, w: 30, h: 30 });
        }

        // Boomstammen
        for (let i = logs.length - 1; i >= 0; i--) {
            let l = logs[i]; l.x -= (6 + level);
            ctx.fillStyle = "#8B4513"; ctx.fillRect(l.x, l.y, l.w, l.h);
            if (p.x < l.x + l.w && p.x + 40 > l.x && p.y < l.y + l.h && p.y + 40 > l.y) gameOver();
            if (l.x < -100) logs.splice(i, 1);
        }

        // Wortels
        for (let i = powerups.length - 1; i >= 0; i--) {
            let c = powerups[i]; c.x -= 5;
            ctx.fillStyle = "orange"; ctx.beginPath(); ctx.moveTo(c.x, c.y); ctx.lineTo(c.x+20, c.y); ctx.lineTo(c.x+10, c.y+30); ctx.fill();
            if (p.x < c.x + 30 && p.x + 40 > c.x && p.y < c.y + 30 && p.y + 40 > c.y) {
                carrots++; score += 100; powerups.splice(i, 1);
            }
        }

        // Stenen schieten
        for (let si = stones.length - 1; si >= 0; si--) {
            let s = stones[si]; s.x += 12;
            ctx.fillStyle = "#555"; ctx.beginPath(); ctx.arc(s.x, s.y, 10, 0, Math.PI*2); ctx.fill();
            
            let hit = false;
            // Hit boomstam
            for (let li = logs.length - 1; li >= 0; li--) {
                let l = logs[li];
                if (s.x > l.x - 20 && s.x < l.x + l.w + 20 && s.y > l.y - 20 && s.y < l.y + l.h + 20) {
                    logs.splice(li, 1); score += 50; hit = true; break;
                }
            }
            // Hit Kat
            if (!hit && cat && s.x > cat.x && s.x < cat.x + 100 && s.y > cat.y && s.y < cat.y + 100) {
                cat.hp--; hit = true;
                if (cat.hp <= 0) { cat = null; score += 1000; level++; }
            }
            if (hit || s.x > 850) stones.splice(si, 1);
        }

        document.getElementById("scoreDisplay").innerText = "Score: " + score;
        document.getElementById("carrotDisplay").innerText = "Wortels: " + carrots + " ðŸ¥•";
        if (score > level * 1000 && !cat) level++;
    }
</script>
</body>
</html>
